{% extends 'template.html'%}
{% load static %}
{% block l_accs %}
    <a href="{% url 'accounts:accs'%}"><li>Все сообщества</li></a>
{% endblock %}
{% block head_main_accounts %}active_under_item{% endblock %}
{% block title %}
        <title>Комплекс серверов Rus-Hytale</title>
        <meta property="og:site_name" content="Rus-Hytale | Сервера по игре Hytale" />
	    <meta property="og:type" content="website" />
		<meta property="og:title" content="Rus-Hytale | Сервера по игре Hytale" />
		<meta property="twitter:title" content="Rus-Hytale | Сервера по игре Hytale" />
		<meta name="Description" content="Официальный сайт русскоязычного комплекса серверов по Hytale"/>
{% endblock %}
{% block left_panel_content_main %}
                {% if User.is_authenticated %}
                <a href="{% url 'accounts:prof' User.identifier %}"><div class="item_left_panel_content_main">Ваш профиль</div></a>
                {% endif %}
                <a href="{% url 'accounts:accs'%}"><div class="item_left_panel_content_main active_item_left_panel_content_main">Все пользователи</div></a>
                {% if User.is_authenticated %}
                {% for acc in accs_p%}
                <a href="{% url 'accounts:prof' acc.user_inter.identifier%}" class="tg_adapt" data-catid={{acc.user_inter.identifier}}><div class="item_left_panel_content_main">{{acc.user_inter.username}}</div></a>
                {% endfor %}
                {% endif %}
{% endblock %}
{% block center_panel_content_main %}
{% load tag_p_check %}
                    <table border="0" width="100%" cellpadding="5" style="color:rgb(233, 233, 233);">
                    <tr style="font-size: 15px;">
                     <th style="text-align:start ;">Название</th>
                     <th width="100">Подписчики</th>
                     <th width="100">Рейтинг</th>
                    </tr>
                        {% for acc in accs %}
                    <tr style="font-size: 20px;">
                     <td style="align-items: center; display: flex;">
                        <img src="{{acc.avatar.url}}" style="width: 44px;
    border-radius: 100%;
    border: 1px solid rgb(233, 233, 233);">
                        <div style="align-items: center; padding-left: 10px;">
                            <a href="{% url 'accounts:prof' acc.identifier %}" class="a_community_communities">
                                <div>{{acc.username}}</div>

                            </a>
                            <div style="font-size: 15px;">
                                {{acc.Description}}
                            </div>
                            {% if User.is_authenticated %}
                            {%if acc.id != User.id%}
                            <a class="go_new_s sub_but" data-catid={{acc.identifier}} style="cursor:pointer;">{{ acc.id|check_acc:User.id }}</a>
                            <a class="go_new_s" data-catid={{acc.identifier}} style="cursor:pointer;">Добавить в друзья</a>
                            {%endif%}
                            {% endif %}
                        </div>
                    </td>
                     <td style="text-align:center ;" class="sub" data-catid={{acc.identifier}}>{{acc.subscribers}}</td>
                     <td style="text-align:center ;">{{acc.Points}}</td>
                   </tr>
                        {% endfor %}
                  </table>
                <script>
            $(function(){
                var data = []
                 $(".sub_but").click(function(){
                     $.ajax({
                        type:"POST",
                        url: "/accounts/",
                        data: {identifier_user: $(this).attr('data-catid')},
                        success: function(data) {
                            var arr_data = data.split(' ');
                            var answer = arr_data[0];
                            var id_tag = arr_data[1];
                            var name = arr_data[2];
                            var sub = arr_data[3];
                            if(answer == '+'){
                                $(".sub_but[data-catid="+id_tag+"]").html('Отписаться');
                                $(".sub[data-catid="+id_tag+"]").html(sub);
                                $(".left_panel_content_main").append("<a href='/accounts/"+id_tag+"' class='tg_adapt' data-catid="+id_tag+"><div class='item_left_panel_content_main'>"+name+"</div></a>");
                            }
                            else{
                                $(".sub_but[data-catid="+id_tag+"]").html('Подписаться');
                                $(".sub[data-catid="+id_tag+"]").html(sub);
                                $(".tg_adapt[data-catid="+id_tag+"]").detach();
                            }

                        }
                    })
                });

            });
        </script>
{% endblock %}

